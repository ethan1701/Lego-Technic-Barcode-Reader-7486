<html>
	<head>
		<script>
			const audio = new Audio('http://soundbible.com/mp3/Buzz-SoundBible.com-1790490578.mp3');
			const timeunit=50;
			const timegap=1000;

			const _0 = "&nbsp;█&nbsp;";
			const _1 = "██&nbsp;";
			const _begin = "█&nbsp;";
			const _end = "███";
			
			var playPromise;
			var bars = [];
			
			const types =
			["Select Type","Tone", "Sound", "Sound & Motor", "Motor","Pre-Programmed"];
			
			const speeds = new Map([
			["SPEED", []],
			["20",		[_begin,_1,_0,_1,_1,_1,_1,_1,_1,_0,_0,_end]],
			["40",		[_begin,_1,_0,_0,_1,_1,_1,_1,_1,_0,_1,_end]],
			["60",		[_begin,_0,_1,_1,_1,_1,_1,_1,_1,_1,_0,_end]],
			["Varying",	[_begin,_0,_1,_0,_1,_1,_1,_1,_1,_1,_1,_end]]
			]);
			
			const motor = new Map([
			["MOTOR DIRECTION", []],
			["↩️",			[_begin,_1,_1,_1,_0,_0,_0,_0,_0,_0,_0,_end]],
			["🛑",			[_begin,_0,_1,_1,_0,_0,_0,_1,_0,_1,_0,_end]],
			["↪️",			[_begin,_1,_1,_0,_0,_0,_0,_0,_0,_0,_1,_end]]
			]);
			
			const tones = new Map([
			["TONE",[]],
			["🎵 C",			[_begin,_1,_1,_0,_1,_1,_0,_0,_0,_1,_1,_end]],
			["🎵 C#",		[_begin,_1,_0,_0,_1,_1,_0,_0,_1,_0,_0,_end]],
			["🎵 D",			[_begin,_0,_1,_1,_1,_1,_0,_0,_1,_0,_1,_end]],
			["🎵 D#",		[_begin,_0,_1,_0,_1,_1,_0,_0,_1,_1,_0,_end]],
			["🎵 E",			[_begin,_0,_0,_1,_1,_1,_0,_0,_1,_1,_1,_end]],
			["🎵 F",			[_begin,_1,_1,_1,_1,_1,_0,_1,_0,_0,_0,_end]],
			["🎵 F#",		[_begin,_1,_1,_0,_1,_1,_0,_1,_0,_0,_1,_end]],
			["🎵 G",			[_begin,_1,_0,_1,_1,_1,_0,_1,_0,_1,_0,_end]],
			["🎵 G#",		[_begin,_1,_0,_0,_1,_1,_0,_1,_0,_1,_1,_end]],
			["🎵 A",			[_begin,_0,_1,_0,_1,_1,_0,_1,_1,_0,_0,_end]],
			["🎵 A#",		[_begin,_0,_0,_1,_1,_1,_0,_1,_1,_0,_1,_end]],
			["🎵 B/H",		[_begin,_0,_0,_0,_1,_1,_0,_1,_1,_1,_0,_end]],
			["🎵 C.",		[_begin,_1,_1,_1,_1,_1,_0,_1,_1,_1,_1,_end]]
			]);
			
			const sounds = new Map([
			["SOUND",[]],
			["🔈 🚚",			[_begin,_0,_0,_0,_0,_0,_0,_0,_1,_1,_0,_end]],
			["🔈 🚁",			[_begin,_0,_0,_1,_0,_0,_0,_0,_1,_0,_1,_end]],
			["🔈 🤖",			[_begin,_1,_1,_1,_0,_0,_0,_0,_1,_1,_1,_end]],
			["🔈 ⚙️",			[_begin,_1,_0,_1,_0,_0,_0,_1,_0,_0,_0,_end]],
			["🔈 Air-break",	[_begin,_0,_1,_0,_0,_0,_0,_0,_1,_0,_0,_end]],
			["🔈 🔇",			[_begin,_1,_0,_0,_0,_0,_0,_1,_0,_0,_1,_end]]
			]);
			
			const sensor = new Map([
			["Sensor Status", []],
			["Pressed",		[_begin,_0,_0,_1,_1,_1,_0,_0,_0,_0,_0,_end]],
			["Released",	[_begin,_0,_0,_0,_1,_1,_0,_0,_0,_0,_1,_end]]
			]);
			
			const ampersand = new Map([
			["&",			[_begin,_0,_1,_0,_0,_0,_0,_1,_0,_1,_1,_end]]
			]);
			
			const barcodes =
			{
			Select:			[_begin,_0,_0,_0,_0,_0,_0,_0,_0,_0,_0,_end],
			"Sensor-in":	[_begin,_0,_0,_1,_1,_1,_0,_0,_0,_0,_0,_end],
			"Sensor-out":	[_begin,_0,_0,_0,_1,_1,_0,_0,_0,_0,_1,_end],
			"↩️":			[_begin,_1,_1,_1,_0,_0,_0,_0,_0,_0,_0,_end],
			"🛑":			[_begin,_0,_1,_1,_0,_0,_0,_1,_0,_1,_0,_end],
			"↪️":			[_begin,_1,_1,_0,_0,_0,_0,_0,_0,_0,_1,_end],
			"&":			[_begin,_0,_1,_0,_0,_0,_0,_1,_0,_1,_1,_end],
			"🔈 🚚":			[_begin,_0,_0,_0,_0,_0,_0,_0,_1,_1,_0,_end],
			"🔈 🚁":			[_begin,_0,_0,_1,_0,_0,_0,_0,_1,_0,_1,_end],
			"🔈 🤖":			[_begin,_1,_1,_1,_0,_0,_0,_0,_1,_1,_1,_end],
			"🔈 ⚙️":			[_begin,_1,_0,_1,_0,_0,_0,_1,_0,_0,_0,_end],
			"🔈 Air-break":	[_begin,_0,_1,_0,_0,_0,_0,_0,_1,_0,_0,_end],
			"🔈 🔇":			[_begin,_1,_0,_0,_0,_0,_0,_1,_0,_0,_1,_end],
			"⌚ 1 Sec.":		[_begin,_0,_1,_1,_1,_1,_1,_0,_0,_0,_1,_end],
			"⌚ 2 Sec.":		[_begin,_0,_1,_0,_1,_1,_1,_0,_0,_1,_0,_end],
			"⌚ 3 Sec.":		[_begin,_0,_0,_1,_1,_1,_1,_0,_0,_1,_1,_end],
			"⌚ 4 Sec.":		[_begin,_1,_1,_1,_1,_1,_1,_0,_1,_0,_0,_end],
			"⌚ 5 Sec.":		[_begin,_1,_1,_0,_1,_1,_1,_0,_1,_0,_1,_end],
			"⌚ 6 Sec.":		[_begin,_1,_0,_1,_1,_1,_1,_0,_1,_1,_0,_end],
			"⌚ 7 Sec.":		[_begin,_1,_0,_0,_1,_1,_1,_0,_1,_1,_1,_end],
			"⌚ 8 Sec.":		[_begin,_0,_1,_0,_1,_1,_1,_1,_0,_0,_0,_end],
			"⌚ 9 Sec.":		[_begin,_0,_0,_1,_1,_1,_1,_1,_0,_0,_1,_end],
			"⌚ 0 Sec.":		[_begin,_1,_0,_0,_1,_1,_1,_0,_0,_0,_0,_end],
			"⌚ .":			[_begin,_0,_0,_0,_1,_1,_1,_1,_0,_1,_0,_end],
			"⌚ 🎲 Sec.":	[_begin,_1,_1,_1,_1,_1,_1,_1,_0,_1,_1,_end],
			"Speed: 20":	[_begin,_1,_0,_1,_1,_1,_1,_1,_1,_0,_0,_end],
			"Speed: 40":	[_begin,_1,_0,_0,_1,_1,_1,_1,_1,_0,_1,_end],
			"Speed: 60":	[_begin,_0,_1,_1,_1,_1,_1,_1,_1,_1,_0,_end],
			"Speed: Cog?!":	[_begin,_0,_1,_0,_1,_1,_1,_1,_1,_1,_1,_end],
			"🎵 C":			[_begin,_1,_1,_0,_1,_1,_0,_0,_0,_1,_1,_end],
			"🎵 C#":			[_begin,_1,_0,_0,_1,_1,_0,_0,_1,_0,_0,_end],
			"🎵 D":			[_begin,_0,_1,_1,_1,_1,_0,_0,_1,_0,_1,_end],
			"🎵 D#":			[_begin,_0,_1,_0,_1,_1,_0,_0,_1,_1,_0,_end],
			"🎵 E":			[_begin,_0,_0,_1,_1,_1,_0,_0,_1,_1,_1,_end],
			"🎵 F":			[_begin,_1,_1,_1,_1,_1,_0,_1,_0,_0,_0,_end],
			"🎵 F#":			[_begin,_1,_1,_0,_1,_1,_0,_1,_0,_0,_1,_end],
			"🎵 G":			[_begin,_1,_0,_1,_1,_1,_0,_1,_0,_1,_0,_end],
			"🎵 G#":			[_begin,_1,_0,_0,_1,_1,_0,_1,_0,_1,_1,_end],
			"🎵 A":			[_begin,_0,_1,_0,_1,_1,_0,_1,_1,_0,_0,_end],
			"🎵 A#":			[_begin,_0,_0,_1,_1,_1,_0,_1,_1,_0,_1,_end],
			"🎵 B/H":		[_begin,_0,_0,_0,_1,_1,_0,_1,_1,_1,_0,_end],
			"🎵 C.":			[_begin,_1,_1,_1,_1,_1,_0,_1,_1,_1,_1,_end]
			};
			
			
			function sleep(ms) {
				return new Promise(resolve => setTimeout(resolve, ms));
			}

			function populateLists(){
				var lists = document.getElementsByClassName("barcodeList");
				[].forEach.call(lists, function (list){
					listOptions(list);
				});
				
				var types =  document.getElementsByClassName("types");
				[].forEach.call(types, function (type){
					typeOptions(type);
				});
			}
			
			function listOptions(obj){
				Object.keys(barcodes).forEach(function(key,index) {
					obj.innerHTML += "<option value='"+ key + "'>" + key + "</option>";
				});
			}
			
			function typeOptions(obj){
				types.forEach(function(type){
					obj.innerHTML += "<option value='"+ type + "'>" + type + "</option>";
				});
			}
			
			function showNextLevel(obj){
				var row = obj.parentNode
				var selected;
				var i = 0;
				while (row.lastChild != obj){
					row.removeChild(row.lastChild);
				}
				var toneSelect = document.createElement("select");
				toneSelect.setAttribute("class", "option tone");
				tones.forEach(function(value,index) {
					if (i==0){selected =" selected";}else{selected="";}
					toneSelect.innerHTML += "<option value='"+ value + "'" + selected + ">" + index + "</option>";
					i++;
				});
				
				i=0;
				var SoundSelect = document.createElement("select");
				SoundSelect.setAttribute("class", "option sound");
				sounds.forEach(function(value,index) {
					if (i==0){selected =" selected";}else{selected="";}
					SoundSelect.innerHTML += "<option value='"+ value + "'" + selected + ">" + index + "</option>";
					i++;
				});

				i=0;
				var MotorSelect = document.createElement("select");
				MotorSelect.setAttribute("class", "option motor");
				motor.forEach(function(value,index) {
					if (i==0){selected =" selected";}else{selected="";}
					MotorSelect.innerHTML += "<option value='"+ value + "'" + selected + ">" + index + "</option>";
					i++;
				});

				i=0;
				var SpeedSelect = document.createElement("select");
				SpeedSelect.setAttribute("class", "option speed");
				speeds.forEach(function(value,index) {
					if (i==0){selected =" selected";}else{selected="";}
					SpeedSelect.innerHTML += "<option value='"+ value + "'" + selected + ">" + index + "</option>";
					i++;
				});
				
				var andSpan = document.createElement("span");
				andSpan.setAttribute("class", "option and");
				andSpan.setAttribute("value", "[_begin,_0,_1,_0,_0,_0,_0,_1,_0,_1,_1,_end]");
				
				i=0;
				var SensorSelect = document.createElement("select");
				SensorSelect.setAttribute("class", "option sensor");
				sensor.forEach(function(value,index) {
					if (i==0){selected =" selected";}else{selected="";}
					SensorSelect.innerHTML += "<option value='"+ value + "'" + selected + ">" + index + "</option>";
					i++;
				});
				var SensorSelect1 = SensorSelect.cloneNode(true);
				
				var durationInput = document.createElement("input");
				durationInput.setAttribute("class", "option duration");
				durationInput.setAttribute("value", "Duration (seconds)");
				
				switch(obj.value){
					case "Tone":
						row.appendChild(toneSelect);
						break;
					case "Sound":
						row.appendChild(SensorSelect);
						row.appendChild(SoundSelect);
						row.appendChild(SpeedSelect);
						row.appendChild(durationInput);
						row.appendChild(SensorSelect1);
						break;
					case "Sound & Motor":
						row.appendChild(SensorSelect);
						row.appendChild(SoundSelect);
						row.appendChild(andSpan);
						row.appendChild(MotorSelect);
						row.appendChild(SpeedSelect);
						row.appendChild(durationInput);
						row.appendChild(SensorSelect1);
						break;
					case "Motor":
						row.appendChild(SensorSelect);
						row.appendChild(MotorSelect);
						row.appendChild(SpeedSelect);
						row.appendChild(durationInput);
						row.appendChild(SensorSelect1);
						break;
				}
			}
			
			function PrintBarcode(instruction){
				instruction.parentNode.getElementsByClassName("barcodePrint")[0].innerHTML = barcodes[instruction.value].join("");
			}
			
			function remove(barcode){
				console.log(barcode);
				barcode.parentNode.parentNode.removeChild(barcode.parentNode);
			}
			
			function addInstruction(){
				var instruction = document.getElementsByClassName("instruction")[0].cloneNode(true);
				document.getElementById("instructions").append(instruction);
			}
			
			async function makeItPlay(){
				var instructions = document.getElementsByClassName("option");
				var indicator = document.getElementById("indicator");
				[].forEach.call(instructions,async function (instruction){
					console.log(instruction.value);
					if(instruction.value != "undefined"){
						instruction.style.backgroundColor="yellow";
						var currentBarcode = instruction.value.toString();
						for (var i = 0; i < currentBarcode.length; i++){
							var currentChar = currentBarcode.charAt(i);
							console.log(currentChar);
							if (currentChar != "█"){
								bars.push(["white",timeunit]);
								indicator.style.background = "white";
								play(0);
							} else if (currentChar == "█"){
								bars.push(["black",timeunit]);
								indicator.style.background = "black";
								stop(0);
							}
							await sleep(timeunit);
						}
						instruction.style.backgroundColor="white";
					}
					bars.push(["white",timegap]);
					await sleep(timegap);
				});
//				playBars();
			}
			
			async function playBars(){
				var indicator = document.getElementById("indicator");
				for(var i = 0; i < bars.length; i++){
					indicator.style.background = bars[i][0];
					if(bars[i][0] == "white"){
						play(0);
					} else if(bars[i][0] == "black"){
						stop(0);
					}
					await sleep(bars[i][1]);
				}
				bars=[];
			}
			
			function play() {
				playPromise = audio.play();
			}
			
			function stop(){
				document.body.style.backgroundColor="#fff";
				if (playPromise !== undefined) {
					playPromise.then(_ => {
						audio.pause();
						audio.currentTime = 0;
					})
				}
			}
		</script>
		<style>
			#background{
				position: fixed;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
				background-image: url("https://thelegocarblog.files.wordpress.com/2013/08/221.jpg");
				background-repeat: no-repeat;
				background-attachment: fixed;
				background-size: 100%;
				opacity: 0.4;
				filter:alpha(opacity=40);
			}
			
			#wrapper {
				position: relative;
				padding-top: 16px;
				padding-left:51px;
			}
			.barcode{
				height:30px;
				}
			
			.barcodePrint{
				font-family: monospace;
				border:1px solid black;
				background-color: #fff;
			}
			
			#indicator{
				width:100px;
				height: 100px;
				border:1px solid black;
				background-color: #fff;
			}
		</style>
	</head>
	<body onload="populateLists()">
		<div id="background"></div>
		<div id="wrapper">
			
			<div class="instructions" id="instructions">
				<div class="instruction">
					<button onclick="remove(this)">(Delete)</button>
					<select class="types" onchange="showNextLevel(this)"></select>
					<!--select class="barcodeList"onchange="PrintBarcode(this)">
					</select>
					<span class="barcodePrint"></span-->
				</div>
			</div>
			<button onclick="addInstruction()">Add another</button>
			<button onclick="makeItPlay()">Play</button>
			<div class="indicator" id = "indicator">Place Scanner Here</div>
		</div>
	</body>
</html>
